        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Db class / mongo_dart Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="mongo_dart" data-type="Db">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../mongo_dart.html">mongo_dart</a> &rsaquo; <a href="../mongo_dart/Db.html">Db</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../bson.html">bson</a></h2><h2><div class="icon-library"></div><a href="../bson_vm.html">bson_vm</a></h2><h2><div class="icon-library"></div><a href="../mongo_dart.html">mongo_dart</a></h2><ul class="icon">
<li><a href="../mongo_dart/Connection.html"><div class="icon-class"></div>Connection</a></li>
<li><a href="../mongo_dart/Cursor.html"><div class="icon-class"></div>Cursor</a></li>
<li><div class="icon-class"></div><strong>Db</strong></li>
<li><a href="../mongo_dart/DbCollection.html"><div class="icon-class"></div>DbCollection</a></li>
<li><a href="../mongo_dart/DbCommand.html"><div class="icon-class"></div>DbCommand</a></li>
<li><a href="../mongo_dart/MapProxy.html"><div class="icon-class"></div>MapProxy&lt;K, V&gt;</a></li>
<li><a href="../mongo_dart/MonadicBlock.html"><div class="icon-interface"></div>MonadicBlock</a></li>
<li><a href="../mongo_dart/MongoGetMoreMessage.html"><div class="icon-class"></div>MongoGetMoreMessage</a></li>
<li><a href="../mongo_dart/MongoInsertMessage.html"><div class="icon-class"></div>MongoInsertMessage</a></li>
<li><a href="../mongo_dart/MongoKillCursorsMessage.html"><div class="icon-class"></div>MongoKillCursorsMessage</a></li>
<li><a href="../mongo_dart/MongoMessage.html"><div class="icon-class"></div>MongoMessage</a></li>
<li><a href="../mongo_dart/MongoQueryMessage.html"><div class="icon-class"></div>MongoQueryMessage</a></li>
<li><a href="../mongo_dart/MongoRemoveMessage.html"><div class="icon-class"></div>MongoRemoveMessage</a></li>
<li><a href="../mongo_dart/MongoReplyMessage.html"><div class="icon-class"></div>MongoReplyMessage</a></li>
<li><a href="../mongo_dart/MongoUpdateMessage.html"><div class="icon-class"></div>MongoUpdateMessage</a></li>
<li><a href="../mongo_dart/SelectorBuilder.html"><div class="icon-class"></div>SelectorBuilder&lt;K, V&gt;</a></li>
<li><a href="../mongo_dart/ServerConfig.html"><div class="icon-class"></div>ServerConfig</a></li>
<li><a href="../mongo_dart/Utils.html"><div class="icon-class"></div>Utils</a></li>
</ul>
</div>
<div class="content">
        <h2><strong>Db</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<pre class="source">
class Db{
 String databaseName;
 ServerConfig serverConfig;
 Connection connection;
 validateDatabaseName(String dbName) {
   if(dbName.length === 0) throw "database name cannot be the empty string";
   var invalidChars = [" ", ".", "\$", "/", "\\"];
   for(var i = 0; i &lt; invalidChars.length; i++) {
     if(dbName.indexOf(invalidChars[i]) != -1) throw new Exception("database names cannot contain the character '${invalidChars[i]}'");
   }
 }
 Db.local(this.databaseName){
    if (serverConfig === null) {
     serverConfig = new ServerConfig();
    }
   connection = new Connection(serverConfig);
 }

/**
* Db constructor expects [valid mongodb URI] (http://www.mongodb.org/display/DOCS/Connections).
* For example next code points to local mongodb server on default mongodb port, database *testdb*
*     var db = new Db('mongodb://127.0.0.1/testdb');
* And that code direct to MongoLab server on 37637 port, database *testdb*, username *dart*, password *test*
*     var db = new Db('mongodb://dart:test@ds037637-a.mongolab.com:37637/objectory_blog');
*/
 Db(String uriString){
   var uri = new Uri.fromString(uriString);
   if (uri.scheme != 'mongodb') {
     throw 'Invalid scheme in uri: $uriString ${uri.scheme}';
   }
   serverConfig = new ServerConfig();
   serverConfig.host = uri.domain;
   serverConfig.port = uri.port;
   if (serverConfig.port == null || serverConfig.port == 0){
     serverConfig.port = 27017;
   }
   if (uri.userInfo != '') {
     var userInfo = uri.userInfo.split(':');
     if (userInfo.length != 2) {
       throw 'Неверный формат поля userInfo: $uri.userInfo';
     }
     serverConfig.userName = userInfo[0];
     serverConfig.password = userInfo[1];
   }
   if (uri.path != '') {
     databaseName = uri.path.replaceAll('/','');
   }
   connection = new Connection(serverConfig);
 }
 DbCollection collection(String collectionName){
     return new DbCollection(this,collectionName);
 }
 Future executeQueryMessage(MongoMessage queryMessage){
   return connection.query(queryMessage);
 }
 executeMessage(MongoMessage message){
   connection.execute(message);
 }
 Future open(){
   Completer completer = new Completer();
   initBsonPlatform();
   if (connection.connected){
     connection.close();
     connection = new Connection(serverConfig);
   }
   connection.connect().then((v) {
     if (serverConfig.userName === null) {
       completer.complete(v);
     }
     else {
       authenticate(serverConfig.userName,serverConfig.password).then((v) {
         completer.complete(v);
       });
     }
   });
   return completer.future;
 }
 Future executeDbCommand(MongoMessage message){
     Completer&lt;Map&gt; result = new Completer();
     connection.query(message).then((replyMessage){
       String errMsg;
       if (replyMessage.documents.length == 0) {
         errMsg = "Error executing Db command, Document length 0 $replyMessage";
         print("Error: $errMsg");
         var m = new Map();
         m["errmsg"]=errMsg;
         result.completeException(m);
       } else  if (replyMessage.documents[0]['ok'] == 1.0 &amp;&amp; replyMessage.documents[0]['err'] == null){
         result.complete(replyMessage.documents[0]);
       } else {
         result.completeException(replyMessage.documents[0]);
       }
     });
   return result.future;
 }
 Future dropCollection(String collectionName){
   Completer completer = new Completer();
   collectionsInfoCursor(collectionName).toList().then((v){
     if (v.length == 1){
       executeDbCommand(DbCommand.createDropCollectionCommand(this,collectionName))
         .then((res)=&gt;completer.complete(res));
       } else{
         completer.complete(true);
       }
   });
   return completer.future;
 }
/**
*   Drop current database
*/
 Future drop(){
   return executeDbCommand(DbCommand.createDropDatabaseCommand(this));
 }

 Future removeFromCollection(String collectionName, [Map selector = const {}]){
   return connection.query(new MongoRemoveMessage("$databaseName.$collectionName", selector));
 }

 Future&lt;Map&gt; getLastError(){
   return executeDbCommand(DbCommand.createGetLastErrorCommand(this));
 }
 Future&lt;Map&gt; getNonce(){
   return executeDbCommand(DbCommand.createGetNonceCommand(this));
 }

 Future&lt;Map&gt; wait(){
   return getLastError();
 }
 void close(){
//    print("closing db");
   connection.close();
 }

 Cursor collectionsInfoCursor([String collectionName]) {
   Map selector = {};
   // If we are limiting the access to a specific collection name
   if(collectionName !== null){
     selector["name"] = "${this.databaseName}.$collectionName";
   }
   // Return Cursor
     return new Cursor(this, new DbCollection(this, DbCommand.SYSTEM_NAMESPACE_COLLECTION), selector);
 }

 Future&lt;bool&gt; authenticate(String userName, String password){
   Completer completer = new Completer();
   getNonce().chain((msg) {
     var nonce = msg["nonce"];
     var command = DbCommand.createAuthenticationCommand(this,userName,password,nonce);
     serverConfig.password = '***********';
     return executeDbCommand(command);
   }).
   then((res)=&gt;completer.complete(res["ok"] == 1));
   return completer.future;
 }
 Future&lt;List&gt; indexInformation([String collectionName]) {    
   var selector = {};
   if (collectionName != null) {
     selector['ns'] = '$databaseName.$collectionName';
   }
   return new Cursor(this, new DbCollection(this, DbCommand.SYSTEM_INDEX_COLLECTION), selector).toList();    
 }
 String _createIndexName(Map keys) {
   var name = '';
   keys.forEach((key,value) {
     name = '${name}_${key}_$value';
   });
   return name;    
 }
 Future createIndex(String collectionName, {String key, Map keys, bool unique, bool sparse, bool background, bool dropDups, String name}) {    
   var selector = {};
   selector['ns'] = '$databaseName.$collectionName';
   keys = _setKeys(key, keys);
   selector['key'] = keys;
   for (final order in keys.values) {
     if (order != 1 &amp;&amp; order != -1) {
       throw const ArgumentError('Keys may contain only 1 or -1');  
     }
   }
   if (unique == true) { 
     selector['unique'] = true;
   } else {
     selector['unique'] = false;
   }    
   if (sparse == true) {
     selector['sparse'] = true;
   }
   if (background == true) {
     selector['background'] = true;
   }
   if (dropDups == true) {
     selector['dropDups'] = true;
   }
   if (name ==  null) {
     name = _createIndexName(keys);
   }
   selector['name'] = name;
   MongoInsertMessage insertMessage = new MongoInsertMessage('$databaseName.${DbCommand.SYSTEM_INDEX_COLLECTION}',[selector]);    
   executeMessage(insertMessage);
   return getLastError();
 }

 Map _setKeys(String key, Map keys) {    
   if (key != null &amp;&amp; keys != null) {    
     throw const ArgumentError('Only one parameter must be set: key or keys');    
   }    
   if (key != null) {    
     keys = {'$key': 1};    
   }    
   if (keys == null) {    
     throw const ArgumentError('key or keys parameter must be set');    
   }
   return keys;    
 } 
 Future ensureIndex(String collectionName, {String key, Map keys, bool unique, bool sparse, bool background, bool dropDups, String name}) {
   keys = _setKeys(key, keys);
   var completer = new Completer();
   indexInformation(collectionName).then((indexInfos) {
     if (name == null) {
       name = _createIndexName(keys);
     }        
     if (indexInfos.some((info) =&gt; info['name'] == name)) {
       completer.complete({'ok': 1.0, 'result': 'index preexists'});
     } else {
       return createIndex(collectionName,keys: keys, unique: unique, sparse: sparse, background: background, dropDups: dropDups, name: name);
     }
   });
   return completer.future;
 }  
}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="Db">
<button class="show-code">Code</button>
new <strong>Db</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> uriString) <a class="anchor-link" href="#Db"
              title="Permalink to Db.Db">#</a></h4>
<div class="doc">
<p>Db constructor expects <a href="http://www.mongodb.org/display/DOCS/Connections">valid mongodb URI</a>.
For example next code points to local mongodb server on default mongodb port, database <em>testdb</em></p>
<pre><code>var db = new Db('mongodb://127.0.0.1/testdb');
</code></pre>
<p>And that code direct to MongoLab server on 37637 port, database <em>testdb</em>, username <em>dart</em>, password <em>test</em></p>
<pre><code>var db = new Db('mongodb://dart:test@ds037637-a.mongolab.com:37637/objectory_blog');
</code></pre>
<pre class="source">
Db(String uriString){
 var uri = new Uri.fromString(uriString);
 if (uri.scheme != 'mongodb') {
   throw 'Invalid scheme in uri: $uriString ${uri.scheme}';
 }
 serverConfig = new ServerConfig();
 serverConfig.host = uri.domain;
 serverConfig.port = uri.port;
 if (serverConfig.port == null || serverConfig.port == 0){
   serverConfig.port = 27017;
 }
 if (uri.userInfo != '') {
   var userInfo = uri.userInfo.split(':');
   if (userInfo.length != 2) {
     throw 'Неверный формат поля userInfo: $uri.userInfo';
   }
   serverConfig.userName = userInfo[0];
   serverConfig.password = userInfo[1];
 }
 if (uri.path != '') {
   databaseName = uri.path.replaceAll('/','');
 }
 connection = new Connection(serverConfig);
}
</pre>
</div>
</div>
<div class="method"><h4 id="Db.local">
<button class="show-code">Code</button>
new <strong>Db.local</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> databaseName) <a class="anchor-link" href="#Db.local"
              title="Permalink to Db.Db.local">#</a></h4>
<div class="doc">
<pre class="source">
Db.local(this.databaseName){
  if (serverConfig === null) {
   serverConfig = new ServerConfig();
  }
 connection = new Connection(serverConfig);
}
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="connection">
<button class="show-code">Code</button>
<a href="../mongo_dart/Connection.html">Connection</a>         <strong>connection</strong> <a class="anchor-link"
            href="#connection"
            title="Permalink to Db.connection">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Connection connection;
</pre>
</div>
</div>
<div class="field"><h4 id="databaseName">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/String.html">String</a>         <strong>databaseName</strong> <a class="anchor-link"
            href="#databaseName"
            title="Permalink to Db.databaseName">#</a>
        </h4>
        <div class="doc">
<pre class="source">
String databaseName;
</pre>
</div>
</div>
<div class="field"><h4 id="serverConfig">
<button class="show-code">Code</button>
<a href="../mongo_dart/ServerConfig.html">ServerConfig</a>         <strong>serverConfig</strong> <a class="anchor-link"
            href="#serverConfig"
            title="Permalink to Db.serverConfig">#</a>
        </h4>
        <div class="doc">
<pre class="source">
ServerConfig serverConfig;
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="authenticate">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/bool.html">bool</a>&gt; <strong>authenticate</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> userName, <a href="http://api.dartlang.org/dart_core/String.html">String</a> password) <a class="anchor-link" href="#authenticate"
              title="Permalink to Db.authenticate">#</a></h4>
<div class="doc">
<pre class="source">
Future&lt;bool&gt; authenticate(String userName, String password){
 Completer completer = new Completer();
 getNonce().chain((msg) {
   var nonce = msg["nonce"];
   var command = DbCommand.createAuthenticationCommand(this,userName,password,nonce);
   serverConfig.password = '***********';
   return executeDbCommand(command);
 }).
 then((res)=&gt;completer.complete(res["ok"] == 1));
 return completer.future;
}
</pre>
</div>
</div>
<div class="method"><h4 id="close">
<button class="show-code">Code</button>
void <strong>close</strong>() <a class="anchor-link" href="#close"
              title="Permalink to Db.close">#</a></h4>
<div class="doc">
<pre class="source">
void close(){
//    print("closing db");
 connection.close();
}
</pre>
</div>
</div>
<div class="method"><h4 id="collection">
<button class="show-code">Code</button>
<a href="../mongo_dart/DbCollection.html">DbCollection</a> <strong>collection</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName) <a class="anchor-link" href="#collection"
              title="Permalink to Db.collection">#</a></h4>
<div class="doc">
<pre class="source">
DbCollection collection(String collectionName){
   return new DbCollection(this,collectionName);
}
</pre>
</div>
</div>
<div class="method"><h4 id="collectionsInfoCursor">
<button class="show-code">Code</button>
<a href="../mongo_dart/Cursor.html">Cursor</a> <strong>collectionsInfoCursor</strong>([<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName]) <a class="anchor-link" href="#collectionsInfoCursor"
              title="Permalink to Db.collectionsInfoCursor">#</a></h4>
<div class="doc">
<pre class="source">
Cursor collectionsInfoCursor([String collectionName]) {
 Map selector = {};
 // If we are limiting the access to a specific collection name
 if(collectionName !== null){
   selector["name"] = "${this.databaseName}.$collectionName";
 }
 // Return Cursor
   return new Cursor(this, new DbCollection(this, DbCommand.SYSTEM_NAMESPACE_COLLECTION), selector);
}
</pre>
</div>
</div>
<div class="method"><h4 id="createIndex">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>createIndex</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName, {<a href="http://api.dartlang.org/dart_core/String.html">String</a> key, <a href="http://api.dartlang.org/dart_core/Map.html">Map</a> keys, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> unique, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> sparse, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> background, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> dropDups, <a href="http://api.dartlang.org/dart_core/String.html">String</a> name}) <a class="anchor-link" href="#createIndex"
              title="Permalink to Db.createIndex">#</a></h4>
<div class="doc">
<pre class="source">
Future createIndex(String collectionName, {String key, Map keys, bool unique, bool sparse, bool background, bool dropDups, String name}) {    
 var selector = {};
 selector['ns'] = '$databaseName.$collectionName';
 keys = _setKeys(key, keys);
 selector['key'] = keys;
 for (final order in keys.values) {
   if (order != 1 &amp;&amp; order != -1) {
     throw const ArgumentError('Keys may contain only 1 or -1');  
   }
 }
 if (unique == true) { 
   selector['unique'] = true;
 } else {
   selector['unique'] = false;
 }    
 if (sparse == true) {
   selector['sparse'] = true;
 }
 if (background == true) {
   selector['background'] = true;
 }
 if (dropDups == true) {
   selector['dropDups'] = true;
 }
 if (name ==  null) {
   name = _createIndexName(keys);
 }
 selector['name'] = name;
 MongoInsertMessage insertMessage = new MongoInsertMessage('$databaseName.${DbCommand.SYSTEM_INDEX_COLLECTION}',[selector]);    
 executeMessage(insertMessage);
 return getLastError();
}
</pre>
</div>
</div>
<div class="method"><h4 id="drop">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>drop</strong>() <a class="anchor-link" href="#drop"
              title="Permalink to Db.drop">#</a></h4>
<div class="doc">
<p>  Drop current database</p>
<pre class="source">
Future drop(){
 return executeDbCommand(DbCommand.createDropDatabaseCommand(this));
}
</pre>
</div>
</div>
<div class="method"><h4 id="dropCollection">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>dropCollection</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName) <a class="anchor-link" href="#dropCollection"
              title="Permalink to Db.dropCollection">#</a></h4>
<div class="doc">
<pre class="source">
Future dropCollection(String collectionName){
 Completer completer = new Completer();
 collectionsInfoCursor(collectionName).toList().then((v){
   if (v.length == 1){
     executeDbCommand(DbCommand.createDropCollectionCommand(this,collectionName))
       .then((res)=&gt;completer.complete(res));
     } else{
       completer.complete(true);
     }
 });
 return completer.future;
}
</pre>
</div>
</div>
<div class="method"><h4 id="ensureIndex">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>ensureIndex</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName, {<a href="http://api.dartlang.org/dart_core/String.html">String</a> key, <a href="http://api.dartlang.org/dart_core/Map.html">Map</a> keys, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> unique, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> sparse, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> background, <a href="http://api.dartlang.org/dart_core/bool.html">bool</a> dropDups, <a href="http://api.dartlang.org/dart_core/String.html">String</a> name}) <a class="anchor-link" href="#ensureIndex"
              title="Permalink to Db.ensureIndex">#</a></h4>
<div class="doc">
<pre class="source">
Future ensureIndex(String collectionName, {String key, Map keys, bool unique, bool sparse, bool background, bool dropDups, String name}) {
 keys = _setKeys(key, keys);
 var completer = new Completer();
 indexInformation(collectionName).then((indexInfos) {
   if (name == null) {
     name = _createIndexName(keys);
   }        
   if (indexInfos.some((info) =&gt; info['name'] == name)) {
     completer.complete({'ok': 1.0, 'result': 'index preexists'});
   } else {
     return createIndex(collectionName,keys: keys, unique: unique, sparse: sparse, background: background, dropDups: dropDups, name: name);
   }
 });
 return completer.future;
}
</pre>
</div>
</div>
<div class="method"><h4 id="executeDbCommand">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>executeDbCommand</strong>(<a href="../mongo_dart/MongoMessage.html">MongoMessage</a> message) <a class="anchor-link" href="#executeDbCommand"
              title="Permalink to Db.executeDbCommand">#</a></h4>
<div class="doc">
<pre class="source">
Future executeDbCommand(MongoMessage message){
   Completer&lt;Map&gt; result = new Completer();
   connection.query(message).then((replyMessage){
     String errMsg;
     if (replyMessage.documents.length == 0) {
       errMsg = "Error executing Db command, Document length 0 $replyMessage";
       print("Error: $errMsg");
       var m = new Map();
       m["errmsg"]=errMsg;
       result.completeException(m);
     } else  if (replyMessage.documents[0]['ok'] == 1.0 &amp;&amp; replyMessage.documents[0]['err'] == null){
       result.complete(replyMessage.documents[0]);
     } else {
       result.completeException(replyMessage.documents[0]);
     }
   });
 return result.future;
}
</pre>
</div>
</div>
<div class="method"><h4 id="executeMessage">
<button class="show-code">Code</button>
<strong>executeMessage</strong>(<a href="../mongo_dart/MongoMessage.html">MongoMessage</a> message) <a class="anchor-link" href="#executeMessage"
              title="Permalink to Db.executeMessage">#</a></h4>
<div class="doc">
<pre class="source">
executeMessage(MongoMessage message){
 connection.execute(message);
}
</pre>
</div>
</div>
<div class="method"><h4 id="executeQueryMessage">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>executeQueryMessage</strong>(<a href="../mongo_dart/MongoMessage.html">MongoMessage</a> queryMessage) <a class="anchor-link" href="#executeQueryMessage"
              title="Permalink to Db.executeQueryMessage">#</a></h4>
<div class="doc">
<pre class="source">
Future executeQueryMessage(MongoMessage queryMessage){
 return connection.query(queryMessage);
}
</pre>
</div>
</div>
<div class="method"><h4 id="getLastError">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&gt; <strong>getLastError</strong>() <a class="anchor-link" href="#getLastError"
              title="Permalink to Db.getLastError">#</a></h4>
<div class="doc">
<pre class="source">
Future&lt;Map&gt; getLastError(){
 return executeDbCommand(DbCommand.createGetLastErrorCommand(this));
}
</pre>
</div>
</div>
<div class="method"><h4 id="getNonce">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&gt; <strong>getNonce</strong>() <a class="anchor-link" href="#getNonce"
              title="Permalink to Db.getNonce">#</a></h4>
<div class="doc">
<pre class="source">
Future&lt;Map&gt; getNonce(){
 return executeDbCommand(DbCommand.createGetNonceCommand(this));
}
</pre>
</div>
</div>
<div class="method"><h4 id="indexInformation">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/List.html">List</a>&gt; <strong>indexInformation</strong>([<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName]) <a class="anchor-link" href="#indexInformation"
              title="Permalink to Db.indexInformation">#</a></h4>
<div class="doc">
<pre class="source">
Future&lt;List&gt; indexInformation([String collectionName]) {    
 var selector = {};
 if (collectionName != null) {
   selector['ns'] = '$databaseName.$collectionName';
 }
 return new Cursor(this, new DbCollection(this, DbCommand.SYSTEM_INDEX_COLLECTION), selector).toList();    
}
</pre>
</div>
</div>
<div class="method"><h4 id="open">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>open</strong>() <a class="anchor-link" href="#open"
              title="Permalink to Db.open">#</a></h4>
<div class="doc">
<pre class="source">
Future open(){
 Completer completer = new Completer();
 initBsonPlatform();
 if (connection.connected){
   connection.close();
   connection = new Connection(serverConfig);
 }
 connection.connect().then((v) {
   if (serverConfig.userName === null) {
     completer.complete(v);
   }
   else {
     authenticate(serverConfig.userName,serverConfig.password).then((v) {
       completer.complete(v);
     });
   }
 });
 return completer.future;
}
</pre>
</div>
</div>
<div class="method"><h4 id="removeFromCollection">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>removeFromCollection</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> collectionName, [<a href="http://api.dartlang.org/dart_core/Map.html">Map</a> selector = const{}]) <a class="anchor-link" href="#removeFromCollection"
              title="Permalink to Db.removeFromCollection">#</a></h4>
<div class="doc">
<pre class="source">
Future removeFromCollection(String collectionName, [Map selector = const {}]){
 return connection.query(new MongoRemoveMessage("$databaseName.$collectionName", selector));
}
</pre>
</div>
</div>
<div class="method"><h4 id="validateDatabaseName">
<button class="show-code">Code</button>
<strong>validateDatabaseName</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> dbName) <a class="anchor-link" href="#validateDatabaseName"
              title="Permalink to Db.validateDatabaseName">#</a></h4>
<div class="doc">
<pre class="source">
validateDatabaseName(String dbName) {
 if(dbName.length === 0) throw "database name cannot be the empty string";
 var invalidChars = [" ", ".", "\$", "/", "\\"];
 for(var i = 0; i &lt; invalidChars.length; i++) {
   if(dbName.indexOf(invalidChars[i]) != -1) throw new Exception("database names cannot contain the character '${invalidChars[i]}'");
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="wait">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&gt; <strong>wait</strong>() <a class="anchor-link" href="#wait"
              title="Permalink to Db.wait">#</a></h4>
<div class="doc">
<pre class="source">
Future&lt;Map&gt; wait(){
 return getLastError();
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page was generated at 2012-11-11 18:14:51.051</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
