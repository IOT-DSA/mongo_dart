        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>ObjectoryDirectConnectionImpl Class / objectory_direct_connection Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="objectory_direct_connection" data-type="ObjectoryDirectConnectionImpl">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../objectory_direct_connection.html">objectory_direct_connection</a> &rsaquo; <a href="../objectory_direct_connection/ObjectoryDirectConnectionImpl.html">ObjectoryDirectConnectionImpl</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../bson.html">bson</a></h2><h2><div class="icon-library"></div><a href="../bson_vm.html">bson_vm</a></h2><h2><div class="icon-library"></div><a href="../mongo.html">mongo</a></h2><h2><div class="icon-library"></div><a href="../objectory.html">objectory</a></h2><h2><div class="icon-library"></div><a href="../objectory_base.html">objectory_base</a></h2><h2><div class="icon-library"></div><a href="../objectory_direct_connection.html">objectory_direct_connection</a></h2><ul class="icon">
<li><div class="icon-class"></div><strong>ObjectoryDirectConnectionImpl</strong></li>
</ul>
<h2><div class="icon-library"></div><a href="../objectory_query.html">objectory_query</a></h2><h2><div class="icon-library"></div><a href="../persistent_object.html">persistent_object</a></h2><h2><div class="icon-library"></div><a href="../persistent_schema.html">persistent_schema</a></h2></div>
<div class="content">
        <h2><strong>ObjectoryDirectConnectionImpl</strong>
          Class
        </h2>
        
<div class="doc">

</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../objectory_base/ObjectoryBaseImpl.html">ObjectoryBaseImpl</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>ObjectoryDirectConnectionImpl</strong></span></p>
<h3>Methods</h3>
<div class="method"><h4 id="close">
<span class="show-code">Code</span>
void <strong>close</strong>() <a class="anchor-link" href="#close"
              title="Permalink to ObjectoryDirectConnectionImpl.close">#</a></h4>
<div class="doc">

<pre class="source">
void close(){
  db.close();
}
</pre>
</div>
</div>
<div class="method"><h4 id="dropCollections">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a> <strong>dropCollections</strong>() <a class="anchor-link" href="#dropCollections"
              title="Permalink to ObjectoryDirectConnectionImpl.dropCollections">#</a></h4>
<div class="doc">

<pre class="source">
Future dropCollections() {
  List futures = [];
  schemata.forEach( (key, value) {
     if (value.isRoot) {
      futures.add(db.collection(key).drop());
     }
  });
  return Futures.wait(futures);
}
</pre>
</div>
</div>
<div class="method"><h4 id="dropDb">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&gt; <strong>dropDb</strong>() <a class="anchor-link" href="#dropDb"
              title="Permalink to ObjectoryDirectConnectionImpl.dropDb">#</a></h4>
<div class="doc">

<pre class="source">
Future&lt;Map&gt; dropDb(){
  return db.drop();
}
</pre>
</div>
</div>
<div class="method"><h4 id="find">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="../persistent_object/RootPersistentObject.html">RootPersistentObject</a>&gt;&gt; <strong>find</strong>(<a href="../objectory_query/ObjectoryQueryBuilder.html">ObjectoryQueryBuilder</a> selector) <a class="anchor-link" href="#find"
              title="Permalink to ObjectoryDirectConnectionImpl.find">#</a></h4>
<div class="doc">

<pre class="source">
Future&lt;List&lt;RootPersistentObject&gt;&gt; find(ObjectoryQueryBuilder selector){    
  Completer completer = new Completer();
  var result = new List&lt;RootPersistentObject&gt;();
  db.collection(selector.className)
    .find(selector.map)
    .each((map){
      RootPersistentObject obj = objectory.map2Object(selector.className,map);
      result.add(obj);
    }).then((_) =&gt; completer.complete(result));
  return completer.future;  
}
</pre>
</div>
</div>
<div class="method"><h4 id="findOne">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="../persistent_object/RootPersistentObject.html">RootPersistentObject</a>&gt; <strong>findOne</strong>(<a href="../objectory_query/ObjectoryQueryBuilder.html">ObjectoryQueryBuilder</a> selector) <a class="anchor-link" href="#findOne"
              title="Permalink to ObjectoryDirectConnectionImpl.findOne">#</a></h4>
<div class="doc">

<pre class="source">
Future&lt;RootPersistentObject&gt; findOne(ObjectoryQueryBuilder selector){
  Completer completer = new Completer();
  var obj;
  if (selector.map.containsKey("_id")) {
    obj = findInCache(selector.map["_id"]);
  }
  if (obj !== null) {
    completer.complete(obj);
  }  
  else {
    db.collection(selector.className)
      .findOne(selector.map)
      .then((map){
        if (map === null) {
         completer.complete(null); 
        }
        else {
          obj = findInCache(map["_id"]);          
          if (obj === null) {
            if (map !== null) {
              obj = objectory.map2Object(selector.className,map);
              addToCache(obj);
              }              
            }
          completer.complete(obj);
        }              
      });
    }    
  return completer.future;  
}
</pre>
</div>
</div>
<div class="method"><h4 id="open">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/bool.html">bool</a>&gt; <strong>open</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> uri) <a class="anchor-link" href="#open"
              title="Permalink to ObjectoryDirectConnectionImpl.open">#</a></h4>
<div class="doc">

<pre class="source">
Future&lt;bool&gt; open(String uri){
  if (db !== null){
    db.close();
  }    
  db = new Db(uri);
  return db.open();
}
</pre>
</div>
</div>
<div class="method"><h4 id="remove">
<span class="show-code">Code</span>
void <strong>remove</strong>(<a href="../persistent_object/RootPersistentObject.html">RootPersistentObject</a> persistentObject) <a class="anchor-link" href="#remove"
              title="Permalink to ObjectoryDirectConnectionImpl.remove">#</a></h4>
<div class="doc">

<pre class="source">
void remove(RootPersistentObject persistentObject){
  if (persistentObject.id === null){
    return;
  }
  db.collection(persistentObject.type).remove({"_id":persistentObject.id});
}
</pre>
</div>
</div>
<div class="method"><h4 id="save">
<span class="show-code">Code</span>
void <strong>save</strong>(<a href="../persistent_object/RootPersistentObject.html">RootPersistentObject</a> persistentObject) <a class="anchor-link" href="#save"
              title="Permalink to ObjectoryDirectConnectionImpl.save">#</a></h4>
<div class="doc">

<pre class="source">
void save(RootPersistentObject persistentObject){
  db.collection(persistentObject.type).save(persistentObject.map);
  persistentObject.id = persistentObject.map["_id"];
}
</pre>
</div>
</div>
<div class="method"><h4 id="wait">
<span class="show-code">Code</span>
<a href="http://api.dartlang.org/dart_core/Future.html">Future</a>&lt;<a href="http://api.dartlang.org/dart_core/Map.html">Map</a>&gt; <strong>wait</strong>() <a class="anchor-link" href="#wait"
              title="Permalink to ObjectoryDirectConnectionImpl.wait">#</a></h4>
<div class="doc">

<pre class="source">
Future&lt;Map&gt; wait(){
  return db.wait();
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="db">
<span class="show-code">Code</span>
<a href="../mongo/Db.html">Db</a>         <strong>db</strong> <a class="anchor-link"
            href="#db"
            title="Permalink to ObjectoryDirectConnectionImpl.db">#</a>
        </h4>
        <div class="doc">

<pre class="source">
Db db;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page was generated at 2012-09-12 16:03:43.309</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
